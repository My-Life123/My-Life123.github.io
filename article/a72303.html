<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        poi通过事件驱动模式sax解析大excel文件 - undefined
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 5.4.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> sometimes code， sometimes design </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar radius">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>FENG.M</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> sometimes code， sometimes design </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        poi通过事件驱动模式sax解析大excel文件
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2019-12-24 18:03:34</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#POI" title="POI">POI</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <blockquote>
<p>1.解析类    </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.master.industry.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.BuiltinFormats;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.DataFormatter;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.model.SharedStringsTable;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.model.StylesTable;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFCellStyle;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.usermodel.XSSFRichTextString;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.Attributes;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.SAXException;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.helpers.DefaultHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.DecimalFormat;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> M_YF</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/10/31</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 处理大数据量Excel</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BigExcelParse</span> <span class="keyword">extends</span> <span class="title">DefaultHandler</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">xssfDataType</span> </span>&#123;</span><br><span class="line">        BOOL, ERROR, FORMULA, INLINESTR, SSTINDEX, NUMBER,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Table with styles</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> StylesTable stylesTable;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取SST 的索引对应的值</span></span><br><span class="line">    <span class="keyword">private</span> SharedStringsTable sharedStringsTable;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最大列数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> minColumnCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//单元格内容是SST 的索引</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> vIsOpen;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> xssfDataType nextDataType;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">short</span> formatIndex;</span><br><span class="line">    <span class="keyword">private</span> String formatString;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DataFormatter formatter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> thisColumn = -<span class="number">1</span>;</span><br><span class="line">    <span class="comment">// The last column printed to the output stream</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> lastColumnNumber = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Gathers characters as they are seen.</span></span><br><span class="line">    <span class="keyword">private</span> StringBuffer value;</span><br><span class="line">    <span class="keyword">private</span> String[] record;<span class="comment">//封装每一行的结果</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String[]&gt; rows = <span class="keyword">new</span> LinkedList&lt;&gt;();<span class="comment">//封装结果</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isCellNull = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> SimpleDateFormat sdf = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DecimalFormat df = <span class="keyword">new</span> DecimalFormat(<span class="string">&quot;###########&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BigExcelParse</span><span class="params">(StylesTable styles,</span></span></span><br><span class="line"><span class="params"><span class="function">                         SharedStringsTable strings, <span class="keyword">int</span> cols)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stylesTable = styles;</span><br><span class="line">        <span class="keyword">this</span>.sharedStringsTable = strings;</span><br><span class="line">        <span class="keyword">this</span>.minColumnCount = cols;</span><br><span class="line">        <span class="keyword">this</span>.value = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">this</span>.nextDataType = xssfDataType.NUMBER;</span><br><span class="line">        <span class="keyword">this</span>.formatter = <span class="keyword">new</span> DataFormatter();</span><br><span class="line">        record = <span class="keyword">new</span> String[<span class="keyword">this</span>.minColumnCount];</span><br><span class="line">        rows.clear();<span class="comment">// 每次读取都清空行集合</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startElement</span><span class="params">(String uri, String localName, String name,</span></span></span><br><span class="line"><span class="params"><span class="function">                             Attributes attributes)</span> <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;inlineStr&quot;</span>.equals(name) || <span class="string">&quot;v&quot;</span>.equals(name)) &#123;</span><br><span class="line">            vIsOpen = <span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">// Clear contents cache</span></span><br><span class="line">            value.setLength(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// c =&gt; cell</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;c&quot;</span>.equals(name)) &#123;</span><br><span class="line">            <span class="comment">// Get the cell reference</span></span><br><span class="line">            String r = attributes.getValue(<span class="string">&quot;r&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> firstDigit = -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> c = <span class="number">0</span>; c &lt; r.length(); ++c) &#123;</span><br><span class="line">                <span class="keyword">if</span> (Character.isDigit(r.charAt(c))) &#123;</span><br><span class="line">                    firstDigit = c;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            thisColumn = nameToColumn(r.substring(<span class="number">0</span>, firstDigit));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Set up defaults.</span></span><br><span class="line">            <span class="keyword">this</span>.nextDataType = xssfDataType.NUMBER;</span><br><span class="line">            <span class="keyword">this</span>.formatIndex = -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">this</span>.formatString = <span class="keyword">null</span>;</span><br><span class="line">            String cellType = attributes.getValue(<span class="string">&quot;t&quot;</span>);</span><br><span class="line">            String cellStyleStr = attributes.getValue(<span class="string">&quot;s&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;b&quot;</span>.equals(cellType))</span><br><span class="line">                nextDataType = xssfDataType.BOOL;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;e&quot;</span>.equals(cellType))</span><br><span class="line">                nextDataType = xssfDataType.ERROR;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;inlineStr&quot;</span>.equals(cellType))</span><br><span class="line">                nextDataType = xssfDataType.INLINESTR;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;s&quot;</span>.equals(cellType))</span><br><span class="line">                nextDataType = xssfDataType.SSTINDEX;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;str&quot;</span>.equals(cellType))</span><br><span class="line">                nextDataType = xssfDataType.FORMULA;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cellStyleStr != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// It&#x27;s a number, but almost certainly one</span></span><br><span class="line">                <span class="comment">// with a special style or format</span></span><br><span class="line">                <span class="keyword">int</span> styleIndex = Integer.parseInt(cellStyleStr);</span><br><span class="line">                XSSFCellStyle style = stylesTable.getStyleAt(styleIndex);</span><br><span class="line">                <span class="keyword">this</span>.formatIndex = style.getDataFormat();</span><br><span class="line">                <span class="keyword">this</span>.formatString = style.getDataFormatString();</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.formatString == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">this</span>.formatString = BuiltinFormats</span><br><span class="line">                            .getBuiltinFormat(<span class="keyword">this</span>.formatIndex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">endElement</span><span class="params">(String uri, String localName, String name)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line"></span><br><span class="line">        String thisStr = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// v =&gt; contents of a cell</span></span><br><span class="line">        <span class="comment">//单元格内容标签结束，characters方法会被调用处理内容</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;v&quot;</span>.equals(name)) &#123;</span><br><span class="line">            <span class="comment">// Process the value contents as required.</span></span><br><span class="line">            <span class="comment">// Do now, as characters() may be called more than once</span></span><br><span class="line">            <span class="keyword">switch</span> (nextDataType) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> BOOL:</span><br><span class="line">                    <span class="keyword">char</span> first = value.charAt(<span class="number">0</span>);</span><br><span class="line">                    thisStr = first == <span class="string">&#x27;0&#x27;</span> ? <span class="string">&quot;FALSE&quot;</span> : <span class="string">&quot;TRUE&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> ERROR:</span><br><span class="line">                    thisStr = <span class="string">&quot;\&quot;ERROR:&quot;</span> + value.toString() + <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> FORMULA:</span><br><span class="line">                    <span class="comment">// A formula could result in a string value,</span></span><br><span class="line">                    <span class="comment">// so always add double-quote characters.</span></span><br><span class="line">                    thisStr = value.toString();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> INLINESTR:</span><br><span class="line">                    <span class="comment">// <span class="doctag">TODO:</span> have seen an example of this, so it&#x27;s untested.</span></span><br><span class="line">                    XSSFRichTextString rtsi = <span class="keyword">new</span> XSSFRichTextString(</span><br><span class="line">                            value.toString());</span><br><span class="line">                    thisStr =rtsi.toString();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> SSTINDEX:</span><br><span class="line">                    String sstIndex = value.toString();</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">int</span> idx = Integer.parseInt(sstIndex);</span><br><span class="line">                        XSSFRichTextString rtss = <span class="keyword">new</span> XSSFRichTextString(</span><br><span class="line">                                sharedStringsTable.getEntryAt(idx));</span><br><span class="line">                        thisStr = rtss.toString();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (NumberFormatException ex) &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;Failed to parse SST index &#x27;&quot;</span> + sstIndex</span><br><span class="line">                                + <span class="string">&quot;&#x27;: &quot;</span> + ex.toString());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> NUMBER:</span><br><span class="line">                    String n = value.toString();</span><br><span class="line">                    <span class="comment">// 判断是否是日期格式</span></span><br><span class="line">                    <span class="keyword">if</span> (formatIndex == <span class="number">14</span> || formatIndex == <span class="number">31</span> || formatIndex == <span class="number">57</span> || formatIndex == <span class="number">58</span></span><br><span class="line">                            || (<span class="number">176</span>&lt;=formatIndex &amp;&amp; formatIndex&lt;=<span class="number">178</span>) || (<span class="number">182</span>&lt;=formatIndex &amp;&amp; formatIndex&lt;=<span class="number">196</span>)</span><br><span class="line">                            || (<span class="number">210</span>&lt;=formatIndex &amp;&amp; formatIndex&lt;=<span class="number">213</span>) || (<span class="number">208</span>==formatIndex ) ) &#123;<span class="comment">// 日期</span></span><br><span class="line">                        sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">                        Date date = org.apache.poi.ss.usermodel.DateUtil.getJavaDate(Double.parseDouble(n));</span><br><span class="line">                        thisStr=sdf.format(date);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (formatIndex == <span class="number">20</span> || formatIndex == <span class="number">32</span> || formatIndex==<span class="number">183</span> || (<span class="number">200</span>&lt;=formatIndex &amp;&amp; formatIndex&lt;=<span class="number">209</span>)) &#123;<span class="comment">//时间</span></span><br><span class="line">                        sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;HH:mm&quot;</span>);</span><br><span class="line">                        Date date = org.apache.poi.ss.usermodel.DateUtil.getJavaDate(Double.parseDouble(n));</span><br><span class="line">                        thisStr = sdf.format(date);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">if</span>(n.contains(<span class="string">&quot;E&quot;</span>))&#123;<span class="comment">//科学计数法</span></span><br><span class="line">                            String[] split = n.split(<span class="string">&quot;\\+&quot;</span>);</span><br><span class="line">                            String e = split[<span class="number">0</span>].replaceAll(<span class="string">&quot;E|e&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                            thisStr=e.replace(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">                        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                            thisStr = n;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    thisStr = <span class="string">&quot;(TODO: Unexpected type: &quot;</span> + nextDataType + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (lastColumnNumber == -<span class="number">1</span>) &#123;</span><br><span class="line">                lastColumnNumber = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//判断单元格的值是否为空</span></span><br><span class="line">            <span class="keyword">if</span> (thisStr == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(isCellNull)) &#123;</span><br><span class="line">                isCellNull = <span class="keyword">true</span>;<span class="comment">// 设置单元格是否为空值</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(thisColumn&lt;record.length)</span><br><span class="line">                record[thisColumn] = thisStr;</span><br><span class="line">            <span class="comment">// Update column</span></span><br><span class="line">            <span class="keyword">if</span> (thisColumn &gt; -<span class="number">1</span>)</span><br><span class="line">                lastColumnNumber = thisColumn;</span><br><span class="line">            <span class="comment">//行结束,存储一行数据</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;row&quot;</span>.equals(name)) &#123;</span><br><span class="line">            <span class="comment">// Print out any missing commas if needed</span></span><br><span class="line">            <span class="keyword">if</span> (minColumnCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// Columns are 0 based</span></span><br><span class="line">                <span class="keyword">if</span> (lastColumnNumber == -<span class="number">1</span>) &#123;</span><br><span class="line">                    lastColumnNumber = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 判断是否空行</span></span><br><span class="line">                <span class="keyword">if</span>(record!=<span class="keyword">null</span> &amp;&amp;record.length!=<span class="number">0</span>)&#123;</span><br><span class="line">                    rows.add(record.clone());</span><br><span class="line">                    isCellNull = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; record.length; i++) &#123;</span><br><span class="line">                        record[i] = <span class="keyword">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            lastColumnNumber = -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;String[]&gt; getRows() &#123;</span><br><span class="line">        <span class="keyword">return</span> rows;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRows</span><span class="params">(List&lt;String[]&gt; rows)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rows = rows;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">characters</span><span class="params">(<span class="keyword">char</span>[] ch, <span class="keyword">int</span> start, <span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> SAXException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (vIsOpen)</span><br><span class="line">            value.append(ch, start, length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">nameToColumn</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> column = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; name.length(); ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = name.charAt(i);</span><br><span class="line">            column = (column + <span class="number">1</span>) * <span class="number">26</span> + c - <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> column;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>2.调用类</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">package com.master.industry.common;</span><br><span class="line"></span><br><span class="line">import org.apache.poi.openxml4j.opc.OPCPackage;</span><br><span class="line">import org.apache.poi.openxml4j.opc.PackageAccess;</span><br><span class="line">import org.apache.poi.xssf.eventusermodel.XSSFReader;</span><br><span class="line">import org.apache.poi.xssf.model.SharedStringsTable;</span><br><span class="line">import org.apache.poi.xssf.model.StylesTable;</span><br><span class="line">import org.xml.sax.InputSource;</span><br><span class="line">import org.xml.sax.XMLReader;</span><br><span class="line">import org.xml.sax.helpers.XMLReaderFactory;</span><br><span class="line"></span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.io.PrintStream;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.LinkedList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @Author M_YF</span><br><span class="line"> * @Date 2019/10/31</span><br><span class="line"> * @Description:</span><br><span class="line"> */</span><br><span class="line">public class BigExcelParseUtils &#123;</span><br><span class="line">    private OPCPackage xlsxPackage;</span><br><span class="line">    private int minColumns;</span><br><span class="line">    private PrintStream output;</span><br><span class="line">    private String sheetName;</span><br><span class="line">    //构造器</span><br><span class="line">    public BigExcelParseUtils(OPCPackage pkg, PrintStream output,</span><br><span class="line">                             String sheetName, int minColumns) &#123;</span><br><span class="line">        this.xlsxPackage = pkg;</span><br><span class="line">        this.output = output;</span><br><span class="line">        this.minColumns = minColumns;</span><br><span class="line">        this.sheetName = sheetName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param path----文件路径</span><br><span class="line">     * @param lastIndexSheet---读取sheet的截止下标</span><br><span class="line">     * @param minColumns---excel的最大列数</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    public static List&lt;String[]&gt; parseSheet(String path, Integer lastIndexSheet, int minColumns)throws Exception &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            List&lt;String[]&gt; result = new LinkedList&lt;&gt;();</span><br><span class="line">            //文件地址</span><br><span class="line">            OPCPackage pkg = OPCPackage.open(path, PackageAccess.READ);</span><br><span class="line">            XSSFReader r = new XSSFReader(pkg);</span><br><span class="line">            //解析的sheet名称</span><br><span class="line">            // InputStream rId1 = r.getSheet(&quot;rId1&quot;);//第一个sheet表</span><br><span class="line">            XSSFReader.SheetIterator sheetsData = (XSSFReader.SheetIterator) r.getSheetsData();</span><br><span class="line">            SharedStringsTable sst = r.getSharedStringsTable();</span><br><span class="line">            StylesTable styles = r.getStylesTable();</span><br><span class="line">            XMLReader parser = XMLReaderFactory.createXMLReader();</span><br><span class="line">            BigExcelParse handler = new BigExcelParse(styles, sst, minColumns);</span><br><span class="line">            parser.setContentHandler(handler);</span><br><span class="line">            //遍历---获取指定的sheet名称</span><br><span class="line">            HashMap&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">            int i = 0;</span><br><span class="line">            while (sheetsData.hasNext()) &#123;</span><br><span class="line">                InputStream in = sheetsData.next();</span><br><span class="line">                InputSource inputSource = new InputSource(in);</span><br><span class="line">                if (lastIndexSheet != null &amp;&amp; lastIndexSheet.equals(i)) &#123;  //设置读取sheet的截止下标</span><br><span class="line">                    in.close();</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                parser.parse(inputSource);</span><br><span class="line">                List&lt;String[]&gt; rows = handler.getRows();//返回所有的封装结果</span><br><span class="line">                result.addAll(rows);</span><br><span class="line">                in.close();</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            return result;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            throw new RuntimeException(&quot;BigExcel读取异常:&#123;&#125;&quot;,e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>参考链接<a target="_blank" rel="noopener" href="https://my.oschina.net/shea1992/blog/2244646">https://my.oschina.net/shea1992/blog/2244646</a></p>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        
        <li>
            <a target="_blank" href="http://weibo.com/2561808975">
                            <span class="fa-stack fa-lg">
                                  <i class="iconfont icon-weibo"></i>
                            </span>
            </a>
        </li>
        

        

        
        <li>
            <a target="_blank"  href="https://github.com/My-Life123">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
	    <span>FRIENDLYLINk</span>
        <span>/</span>
        
        <span><a target="_blank" rel="noopener" href="https://cnsyear.gitee.io/">趙小傑~～</a></span>
        <span>/</span>
        
        <span><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012417405">10000guo</a></span>
        <span>/</span>
        
        <span><a target="_blank" rel="noopener" href="https://blog.linsans.cn">Linsans</a></span>
        <span>/</span>
        
    </p>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
